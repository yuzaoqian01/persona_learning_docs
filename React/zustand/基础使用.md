## 一、安装

```bash
# NPM
npm install zustand
# Or, use any package manager of your choice.
```

创建一个存储

```js
import { create } from 'zustand'

const useStore = create((set) => ({
  bears: 0,
  increasePopulation: () => set((state) => ({ bears: state.bears + 1 })),
  removeAllBears: () => set({ bears: 0 }),
  updateBears: (newBears) => set({ bears: newBears }),
}))
```

组件内使用

```jsx
function BearCounter() {
  const bears = useStore((state) => state.bears)
  return <h1>{bears} bears around here...</h1>
}

function Controls() {
  const increasePopulation = useStore((state) => state.increasePopulation)
  return <button onClick={increasePopulation}>one up</button>
}
```

状态

```ts
import { create } from 'zustand'

type State = {
  count: number
}

type Actions = {
  increment: (qty: number) => void
  decrement: (qty: number) => void
}

const useCountStore = create<State & Actions>((set) => ({
  count: 0,
  increment: (qty: number) => set((state) => ({ count: state.count + qty })),
  decrement: (qty: number) => set((state) => ({ count: state.count - qty })),
}))
```

```ts
import { create } from 'zustand'

type State = {
  count: number
}

type Actions = {
  increment: (qty: number) => void
  decrement: (qty: number) => void
}

type Action = {
  type: keyof Actions
  qty: number
}

const countReducer = (state: State, action: Action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + action.qty }
    case 'decrement':
      return { count: state.count - action.qty }
    default:
      return state
  }
}

const useCountStore = create<State & Actions>((set) => ({
  count: 0,
  dispatch: (action: Action) => set((state) => countReducer(state, action)),
}))
```

```js
// walletStore.js
import { create } from 'zustand'

export const useWalletStore = create((set) => ({
  connected: false,
  address: null,
  chain: null,

  connect: (address, chain) => set({ connected: true, address, chain }),
  disconnect: () => set({ connected: false, address: null, chain: null }),
}))

```

```tsx
import { useWalletStore } from './walletStore'

function WalletStatus() {
  const { connected, address, connect, disconnect } = useWalletStore()

  return (
    <div>
      {connected ? (
        <>
          <p>地址: {address}</p>
          <button onClick={disconnect}>断开连接</button>
        </>
      ) : (
        <button onClick={() => connect('0x123...', 'Ethereum')}>连接钱包</button>
      )}
    </div>
  )
}

```

## 二、Immer + Zustand（可变写法）

```js
import { create } from 'zustand'
import { immer } from 'zustand/middleware/immer'

export const useWalletStore = create(
  immer((set) => ({
    connected: false,
    balances: {},
    connect: (address) =>
      set((state) => {
        state.connected = true
        state.address = address
      }),
    updateBalance: (symbol, amount) =>
      set((state) => {
        state.balances[symbol] = amount
      }),
  }))
)

```

## 三、状态持久化（比如记住钱包连接状态）



```bash
npm install zustand/middleware
```

```js
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

export const useWalletStore = create(
  persist(
    (set) => ({
      connected: false,
      address: null,
      connect: (address) => set({ connected: true, address }),
      disconnect: () => set({ connected: false, address: null }),
    }),
    {
      name: 'wallet-storage', // localStorage key
    }
  )
)

```

## 四、异步操作（例如获取余额）

```js
export const useWalletStore = create((set) => ({
  balance: 0,
  fetchBalance: async (address) => {
    const res = await fetch(`/api/balance?addr=${address}`)
    const data = await res.json()
    set({ balance: data.balance })
  },
}))

```

## 五、选择性订阅（防止组件重复渲染）

```js
const balance = useWalletStore((state) => state.balance)
```

## 六、Zustand 的 Hook 逻辑

每个 store 都是一个 Hook：

```js
const useWalletStore = create(...)
```

→ 所以你可以：

- 在任何组件中直接调用；
- 在自定义 Hook 中组合；
- 在非 React 逻辑中也能读写状态。

例如：

```js
useWalletStore.getState().address
useWalletStore.setState({ connected: true })
```

## 七、总结对比

| 特性     | Zustand                    | Redux            |
| -------- | -------------------------- | ---------------- |
| 模式     | Hook + Store               | Action + Reducer |
| 代码量   | 极少                       | 多               |
| Provider | ❌ 不需要                   | ✅ 需要           |
| 性能     | 高                         | 中等             |
| 适合场景 | WebApp / DApp / 中小型项目 | 大型企业应用     |
| 中间件   | persist / immer / devtools | 同样丰富         |

------

## 
